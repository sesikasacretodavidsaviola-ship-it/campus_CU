; ==========================================
; DIALPLAN - Plan de numérotation
; ==========================================

[general]
static = yes
writeprotect = no
clearglobalvars = no

[globals]
CONSOLE = Console/dsp
IAXINFO = guest
TRUNK = PJSIP/provider

; ==========================================
; CONTEXTE PRINCIPAL
; ==========================================

[from-internal]
; Appels entre extensions (100-199)
exten => _1XX,1,NoOp(=== Appel vers extension ${EXTEN} ===)
 same => n,Set(CALLERID(name)=${CALLERID(name)})
 same => n,Dial(PJSIP/${EXTEN},30,tT)
 same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
 same => n(unavail),VoiceMail(${EXTEN}@default,u)
 same => n,Hangup()
 same => n(busy),VoiceMail(${EXTEN}@default,b)
 same => n,Hangup()

; Extension 100
exten => 100,1,NoOp(=== Appel vers Agent 100 ===)
 same => n,Dial(PJSIP/100,30,tT)
 same => n,Hangup()

; Extension 101
exten => 101,1,NoOp(=== Appel vers Agent 101 ===)
 same => n,Dial(PJSIP/101,30,tT)
 same => n,Hangup()

; Extension 102
exten => 102,1,NoOp(=== Appel vers Agent 102 ===)
 same => n,Dial(PJSIP/102,30,tT)
 same => n,Hangup()

; ==========================================
; SERVICES SPÉCIAUX
; ==========================================

; Echo test (pour tester l'audio)
exten => 999,1,NoOp(=== Echo Test ===)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Playback(demo-echotest)
 same => n,Echo()
 same => n,Playup()

; File d'attente support
exten => 700,1,NoOp(=== File d'attente Support ===)
 same => n,Answer()
 same => n,Set(CHANNEL(language)=fr)
 same => n,Queue(700,tT,,30)
 same => n,Hangup()

; Messagerie vocale - Consultation
exten => *97,1,NoOp(=== Consultation messagerie ===)
 same => n,Answer()
 same => n,VoiceMailMain(${CALLERID(num)}@default)
 same => n,Hangup()

; Messagerie vocale - Dépôt
exten => *98,1,NoOp(=== Dépôt messagerie ===)
 same => n,Answer()
 same => n,VoiceMail(800@default)
 same => n,Hangup()

; ==========================================
; GESTION DES ERREURS
; ==========================================

; Extension invalide
exten => i,1,NoOp(=== Extension invalide ===)
 same => n,Playback(invalid)
 same => n,Hangup()

; Timeout (pas de réponse)
exten => t,1,NoOp(=== Timeout ===)
 same => n,Playback(vm-nobodyavail)
 same => n,Hangup()

; Numéro occupé
exten => h,1,NoOp(=== Appel terminé ===)
 same => n,Hangup()


[general]
static=yes
writeprotect=no

[internal]
; Appels internes uniquement (extensions 1XX)
exten => _1XX,1,NoOp(Appel interne vers ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN},30)
 same => n,Hangup()

; Echo test (pour tester l'audio)
exten => 999,1,NoOp(=== Echo Test ===)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Playback(demo-echotest)
 same => n,Echo()
 same => n,Playup()

; Message d'erreur pour numéros non autorisés
exten => _X.,1,NoOp(Numéro non autorisé: ${EXTEN})
 same => n,Playback(privacy-unident)
 same => n,Hangup()