; ==========================================
; CONFIGURATION PJSIP QUI FONCTIONNAIT
; ==========================================

[global]
type = global
max_forwards = 70
user_agent = Asterisk PBX CampusCU
default_realm = campus-cu.com
; AJOUTS CRITIQUES POUR RÉSOUDRE LE PROBLÈME D'URI
endpoint_identifier_order = username,ip
ignore_uri_user_options = yes
disable_tcp_switch = yes

[transport-wss]
type = transport
protocol = wss
bind = 0.0.0.0:8089
local_net = 172.20.0.0/16
external_media_address = 172.20.0.50
external_signaling_address = 172.20.0.50

; ==========================================
; EXTENSIONS BASIQUES
; ==========================================

; Extension 100
[100]
type = aor
max_contacts = 10
qualify_frequency = 0
remove_existing = yes

[100]
type = endpoint
context = from-internal
disallow = all
allow = opus
allow = ulaw  
allow = alaw
transport = transport-wss
webrtc = yes
media_encryption = dtls
dtls_verify = fingerprint
dtls_setup = actpass
dtls_cert_file = /etc/asterisk/keys/asterisk.pem
ice_support = yes
rtp_symmetric = yes
force_rport = yes
rewrite_contact = yes
aors = 100
callerid = "Agent 100" <100>
use_avpf = yes
media_use_received_transport = yes
direct_media = no
rtcp_mux = yes
 AJOUTS CRITIQUES
identify_by = username
send_rpid = yes
trust_id_inbound = yes
trust_id_outbound = yes
; AJOUT CRITIQUE : Forcer le domaine SIP
from_domain = campus-cu.com
from_user = 100

; Extension 101  
[101]
type = aor
max_contacts = 10
qualify_frequency = 0
remove_existing = yes

[101]
type = endpoint
context = from-internal
disallow = all
allow = opus
allow = ulaw
allow = alaw
transport = transport-wss
webrtc = yes
media_encryption = dtls
dtls_verify = fingerprint
dtls_setup = actpass
dtls_cert_file = /etc/asterisk/keys/asterisk.pem
ice_support = yes
rtp_symmetric = yes
force_rport = yes
rewrite_contact = yes
aors = 101
callerid = "Agent 101" <101>
use_avpf = yes
media_use_received_transport = yes
direct_media = no
rtcp_mux = yes
 AJOUTS CRITIQUES
identify_by = username
send_rpid = yes
trust_id_inbound = yes
trust_id_outbound = yes
; AJOUT CRITIQUE : Forcer le domaine SIP
from_domain = campus-cu.com
from_user = 101

; Extension 102  
[102]
type = aor
max_contacts = 10
qualify_frequency = 0
remove_existing = yes

[102]
type = endpoint
context = from-internal
disallow = all
allow = opus
allow = ulaw
allow = alaw
transport = transport-wss
webrtc = yes
media_encryption = dtls
dtls_verify = fingerprint
dtls_setup = actpass
dtls_cert_file = /etc/asterisk/keys/asterisk.pem
ice_support = yes
rtp_symmetric = yes
force_rport = yes
rewrite_contact = yes
aors = 102
callerid = "Agent 102" <102>
use_avpf = yes
media_use_received_transport = yes
direct_media = no
rtcp_mux = yes
 AJOUTS CRITIQUES
identify_by = username
send_rpid = yes
trust_id_inbound = yes
trust_id_outbound = yes
; AJOUT CRITIQUE : Forcer le domaine SIP
from_domain = campus-cu.com
from_user = 102
